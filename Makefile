CC= g++-4.0 # or gcc-4.0
CFLAGS=
LDFLAGS=-ggdb -Wall -I /usr/local/include/ -I ./include -lcxcore.2.0 -lcv.2.0 -lhighgui.2.0 -lcvaux.2.0 -lml

SOURCES_TEMPLATE_MATCHING=template_matching.c
SOURCES_TEMPLATE_MATCHING_JSON=template_matching_json.c
SOURCES_TEMPLATE_MATCHING_WTB=template_matching_with_trackbar.c
SOURCES_EXTRACT_CONTOURS=extract_contours.c
SOURCES_EXTRACT_CONTOURS_TO_MOSAIC=extract_contours_to_mosaic.c
SOURCES_TEST_CONTOUR_LENGTH=test_contour_length.c
SOURCES_MATCH_WITH_HU_MOMENTS=match_with_hu_moments.c

OBJECTS_TEMPLATE_MATCHING=$(SOURCES_TEMPLATE_MATCHING:.cpp=.o)
OBJECTS_TEMPLATE_MATCHING_JSON=$(SOURCES_TEMPLATE_MATCHING_JSON:.cpp=.o)
OBJECTS_TEMPLATE_MATCHING_WTB=$(SOURCES_TEMPLATE_MATCHING_WTB:.cpp=.o)
OBJECTS_EXTRACT_CONTOURS=$(SOURCES_EXTRACT_CONTOURS:.cpp=.o)
OBJECTS_EXTRACT_CONTOURS_TO_MOSAIC=$(SOURCES_EXTRACT_CONTOURS_TO_MOSAIC:.cpp=.o)
OBJECTS_TEST_CONTOUR_LENGTH=$(SOURCES_TEST_CONTOUR_LENGTH:.cpp=.o)
OBJECTS_MATCH_WITH_HU_MOMENTS=$(SOURCES_MATCH_WITH_HU_MOMENTS:.cpp=.o)

EXECUTABLE_TEMPLATE_MATCHING=template_matching
EXECUTABLE_TEMPLATE_MATCHING_JSON=template_matching_json
EXECUTABLE_TEMPLATE_MATCHING_WTB=template_matching_with_trackbar
EXECUTABLE_EXTRACT_CONTOURS=extract_contours
EXECUTABLE_EXTRACT_CONTOURS_TO_MOSAIC=extract_contours_to_mosaic
EXECUTABLE_TEST_CONTOUR_LENGTH=test_contour_length
EXECUTABLE_MATCH_WITH_HU_MOMENTS=match_with_hu_moments

all: $(SOURCES_TEMPLATE_MATCHING_JSON) $(EXECUTABLE_TEMPLATE_MATCHING_JSON) $(SOURCES_TEMPLATE_MATCHING) $(EXECUTABLE_TEMPLATE_MATCHING) $(SOURCES_TEMPLATE_MATCHING_WTB) $(EXECUTABLE_TEMPLATE_MATCHING_WTB) $(SOURCES_EXTRACT_CONTOURS) $(EXECUTABLE_EXTRACT_CONTOURS) $(SOURCES_EXTRACT_CONTOURS_TO_MOSAIC) $(EXECUTABLE_EXTRACT_CONTOURS_TO_MOSAIC) $(SOURCES_TEST_CONTOUR_LENGTH) $(EXECUTABLE_TEST_CONTOUR_LENGTH) $(SOURCES_MATCH_WITH_HU_MOMENTS) $(EXECUTABLE_MATCH_WITH_HU_MOMENTS)

$(EXECUTABLE_TEMPLATE_MATCHING):
	$(CC) $(LDFLAGS) $(OBJECTS_TEMPLATE_MATCHING) -o $@

$(EXECUTABLE_TEMPLATE_MATCHING_JSON):
	$(CC) $(LDFLAGS) $(OBJECTS_TEMPLATE_MATCHING_JSON) -o $@

$(EXECUTABLE_TEMPLATE_MATCHING_WTB):
	$(CC) $(LDFLAGS) $(OBJECTS_TEMPLATE_MATCHING_WTB) -o $@

$(EXECUTABLE_EXTRACT_CONTOURS):
	$(CC) $(LDFLAGS) $(OBJECTS_EXTRACT_CONTOURS) -o $@

$(EXECUTABLE_EXTRACT_CONTOURS_TO_MOSAIC):
	$(CC) $(LDFLAGS) $(OBJECTS_EXTRACT_CONTOURS_TO_MOSAIC) -o $@

$(EXECUTABLE_TEST_CONTOUR_LENGTH):
	$(CC) $(LDFLAGS) $(OBJECTS_TEST_CONTOUR_LENGTH) -o $@

$(EXECUTABLE_MATCH_WITH_HU_MOMENTS):
	$(CC) $(LDFLAGS) $(OBJECTS_MATCH_WITH_HU_MOMENTS) -o $@

clean:
	rm -rf *.dSYM *o $(EXECUTABLE_TEMPLATE_MATCHING) $(EXECUTABLE_TEMPLATE_MATCHING_WTB) $(EXECUTABLE_TEMPLATE_MATCHING_JSON) $(EXECUTABLE_EXTRACT_CONTOURS) $(EXECUTABLE_EXTRACT_CONTOURS_TO_MOSAIC) $(EXECUTABLE_TEST_CONTOUR_LENGTH) $(EXECUTABLE_MATCH_WITH_HU_MOMENTS)

test:
	./$(EXECUTABLE_TEMPLATE_MATCHING) test_images/palm_7R_1_4.jpg test_images/palm_7R.jpg && ./$(EXECUTABLE_TEMPLATE_MATCHING_WTB) test_images/palm_7R_1_4.jpg test_images/palm_7R.jpg 
	./$(EXECUTABLE_EXTRACT_CONTOURS) test_images/letter_b.png && ./$(EXECUTABLE_EXTRACT_CONTOURS_TO_MOSAIC) test_images/palm_7R.jpg 1 && open test_images/palm_7R.jpg_method1_contour.jpg
	./$(EXECUTABLE_TEMPLATE_MATCHING_JSON) test_images/palm_7R_1_4.jpg test_images/palm_7R.jpg 0.6 
	./$(EXECUTABLE_TEST_CONTOUR_LENGTH) test_images/palm_7R_1_4.jpg
	./$(EXECUTABLE_MATCH_WITH_HU_MOMENTS) test_images/letter_a.png test_images/letter_b.png 3
